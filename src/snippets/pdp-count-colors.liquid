{%- assign swatchGroup1Label = collection.metafields["global"]["swatch-group-1-label"] -%}
{%- assign swatchGroup2Label = collection.metafields["global"]["swatch-group-2-label"] -%}
{%- assign swatchGroup3Label = collection.metafields["global"]["swatch-group-3-label"] -%}
{%- assign colorCount = 0 -%}


{%- if swatchGroup2Label == blank -%}{% comment %} no extra grouping, show them all {% endcomment %}

    {%- for siblingProduct in collection.products -%}{% comment %} all products of this type {% endcomment %}
      {%- if siblingsList contains siblingProduct.id -%}{% comment %} make sure this product can be shown {% endcomment %}
        {%- assign siblingUrl = siblingProduct.url -%}
        {%- if referringCollectionHandle -%}
          {%- assign siblingUrl = siblingProduct.url | within: collections[referringCollectionHandle] -%}
        {%- endif -%}
        {%- assign colorCount = colorCount | plus: 1 -%}
      {%- endif -%}
    {%- endfor -%}

{%- else -%}

    {%- for siblingProduct in collection.products -%}
      {%- if siblingsList contains siblingProduct.id -%}
        {%- if siblingProduct.metafields["global"]["swatch-group"] == 'swatch-group-1' -%}
          {%- assign colorCount = colorCount | plus: 1 -%}
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}



    {%- for siblingProduct in collection.products -%}
      {%- if siblingsList contains siblingProduct.id -%}
        {%- if siblingProduct.metafields["global"]["swatch-group"] == 'swatch-group-2' -%}
          {%- assign colorCount = colorCount | plus: 1 -%}
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}

    {%- for siblingProduct in collection.products -%}
      {%- if siblingsList contains siblingProduct.id -%}
        {%- if siblingProduct.metafields["global"]["swatch-group"] == 'swatch-group-3' -%}
          {%- assign colorCount = colorCount | plus: 1 -%}
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}


{%- endif -%}

{{colorCount}}

{%- assign swatchGroup1Label = nil -%}
{%- assign swatchGroup2Label = nil -%}
{%- assign swatchGroup3Label = nil -%}
{%- assign siblingUrl = nil -%}
{%- assign colorCount = nil -%}
